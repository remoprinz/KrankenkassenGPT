openapi: 3.1.0
info:
  title: Swiss Health Insurance Premium API (Historical + Charts + Leads)
  description: |
    Erweiterte API mit historischen Daten (2016-2025) + Aktuell (2026).
    1.6 Millionen Eintr√§ge, 51 Versicherer: Alle Altersgruppen, alle Franchisen, alle Modelle!
    NEU: Preisentwicklung, Inflationsraten, Jahresvergleiche und Rankings.
    ‚ú® Charts: Automatische Chart-Generierung f√ºr alle Datenendpoints!
    üöÄ NEU v2.4.0: Lead-Erfassung - Kunden k√∂nnen direkt im Chat eine Offerte anfragen!
  version: 2.4.0
  contact:
    name: SwissHealth API Support
    email: remo@ragit.io

servers:
  - url: https://krankenkassen.ragit.io
    description: Production API

security:
  - ApiKeyAuth: []

paths:
  # Neue historische Endpoints
  /premiums/timeline:
    get:
      operationId: getPremiumsTimeline
      summary: Preisentwicklung √ºber Jahre
      description: Zeigt wie sich die Pr√§mie einer Kasse √ºber die Jahre entwickelt hat. Inkl. Trend und 2027 Prognose!
      security:
        - ApiKeyAuth: []
      parameters:
        - name: insurer_id
          in: query
          required: true
          description: Versicherer-ID (z.B. "1318" f√ºr Assura)
          schema:
            type: string
        - name: canton
          in: query
          required: true
          description: Kanton (z.B. "ZH")
          schema:
            type: string
            enum: [AG, AI, AR, BE, BL, BS, FR, GE, GL, GR, JU, LU, NE, NW, OW, SG, SH, SO, SZ, TG, TI, UR, VD, VS, ZG, ZH]
        - name: profile
          in: query
          required: false
          description: Vordefiniertes Profil
          schema:
            type: string
            enum: [single_adult, couple, family_1kid, family_2kids, student, young_adult]
            default: single_adult
        - name: start_year
          in: query
          required: false
          description: Start-Jahr (min 2016)
          schema:
            type: integer
            minimum: 2016
            maximum: 2026
            default: 2016
        - name: end_year
          in: query
          required: false
          description: End-Jahr (max 2026)
          schema:
            type: integer
            minimum: 2016
            maximum: 2026
            default: 2025
      responses:
        '200':
          description: Preisentwicklung mit Statistiken
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  insurer:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                  timeline:
                    type: array
                    items:
                      type: object
                      properties:
                        year:
                          type: integer
                        monthly_premium_chf:
                          type: number
                  statistics:
                    type: object
                    properties:
                      total_change_chf:
                        type: number
                      percent_change:
                        type: number
                      avg_yearly_increase:
                        type: number
                  trend:
                    type: object
                    properties:
                      slope:
                        type: number
                      prediction_2027:
                        type: number
                  chart_url:
                    type: string
                    description: URL zu einem automatisch generierten Liniendiagramm der Preisentwicklung

  /premiums/inflation:
    get:
      operationId: getPremiumsInflation
      summary: Inflationsrate der Pr√§mien
      description: Berechnet die j√§hrliche Inflation der Krankenkassenpr√§mien f√ºr einen Kanton/Profil.
      security:
        - ApiKeyAuth: []
      parameters:
        - name: canton
          in: query
          required: false
          description: Kanton (default "ZH")
          schema:
            type: string
            enum: [AG, AI, AR, BE, BL, BS, FR, GE, GL, GR, JU, LU, NE, NW, OW, SG, SH, SO, SZ, TG, TI, UR, VD, VS, ZG, ZH]
            default: ZH
        - name: age_band
          in: query
          required: false
          description: Altersgruppe
          schema:
            type: string
            enum: [child, young_adult, adult]
            default: adult
        - name: franchise_chf
          in: query
          required: false
          description: Franchise in CHF
          schema:
            type: string
            enum: ["0", "100", "200", "300", "400", "500", "600", "1000", "1500", "2000", "2500"]
            default: "2500"
        - name: model_type
          in: query
          required: false
          description: Versicherungsmodell
          schema:
            type: string
            enum: [standard, hmo, telmed, family_doctor, diverse]
            default: standard
        - name: start_year
          in: query
          required: false
          schema:
            type: integer
            minimum: 2016
            maximum: 2026
            default: 2016
        - name: end_year
          in: query
          required: false
          schema:
            type: integer
            minimum: 2016
            maximum: 2026
            default: 2025
      responses:
        '200':
          description: Inflationsdaten
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  statistics:
                    type: object
                    properties:
                      avg_yearly_inflation:
                        type: number
                        description: Durchschnittliche j√§hrliche Inflation in %
                      total_inflation:
                        type: number
                        description: Gesamte Inflation √ºber Periode in %
                  yearly_data:
                    type: array
                    items:
                      type: object
                      properties:
                        year:
                          type: integer
                        avg_premium_chf:
                          type: number
                        inflation_rate:
                          type: number
                        cumulative_inflation:
                          type: number
                  chart_url:
                    type: string
                    description: URL zu einem kombinierten Balken-/Liniendiagramm der Inflationsentwicklung

  /premiums/compare-years:
    get:
      operationId: compareYears
      summary: Vergleiche zwei Jahre
      description: Direkter Vergleich der Pr√§mien zwischen zwei Jahren. Zeigt welche Kassen teurer/g√ºnstiger wurden.
      security:
        - ApiKeyAuth: []
      parameters:
        - name: year1
          in: query
          required: false
          description: Erstes Jahr
          schema:
            type: string
            default: "2020"
        - name: year2
          in: query
          required: false
          description: Zweites Jahr
          schema:
            type: string
            default: "2026"
        - name: canton
          in: query
          required: false
          description: Kanton
          schema:
            type: string
            default: ZH
        - name: profile
          in: query
          required: false
          description: Profil
          schema:
            type: string
            enum: [single_adult, couple, family_1kid, family_2kids, student, young_adult]
            default: single_adult
        - name: limit
          in: query
          required: false
          description: Anzahl Resultate
          schema:
            type: string
            default: "10"
      responses:
        '200':
          description: Jahresvergleich
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        insurer:
                          type: object
                        model_type:
                          type: string
                        change_chf:
                          type: number
                        change_percent:
                          type: number

  /premiums/ranking:
    get:
      operationId: getPremiumsRanking
      summary: Top-Kassen Ranking √ºber Jahre
      description: Zeigt welche Kassen √ºber die Jahre konstant g√ºnstig waren. Perfekt f√ºr "War Assura schon immer g√ºnstig?"
      security:
        - ApiKeyAuth: []
      parameters:
        - name: canton
          in: query
          required: false
          description: Kanton
          schema:
            type: string
            default: ZH
        - name: profile
          in: query
          required: false
          description: Profil
          schema:
            type: string
            enum: [single_adult, couple, family_1kid, family_2kids, student, young_adult]
            default: single_adult
        - name: years
          in: query
          required: false
          description: Komma-getrennte Jahre (z.B. "2020,2023,2025")
          schema:
            type: string
            default: "2020,2023,2025"
        - name: top
          in: query
          required: false
          description: Top N Kassen pro Jahr
          schema:
            type: string
            default: "5"
      responses:
        '200':
          description: Rankings √ºber Jahre
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  rankings:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: object
                        properties:
                          rank:
                            type: integer
                          insurer:
                            type: string
                          model:
                            type: string
                          premium_chf:
                            type: number
                  insights:
                    type: object
                    properties:
                      consistent_performers:
                        type: array
                        items:
                          type: string

  # Bestehende Endpoints (gek√ºrzt f√ºr √úbersichtlichkeit)
  /meta/sources:
    get:
      operationId: getMetaSources
      summary: Datenquelle und API-Status
      description: Gibt Informationen √ºber verf√ºgbare Jahre und Datenversion zur√ºck.
      responses:
        '200':
          description: Meta-Information

  /premiums/quote:
    get:
      operationId: getPremiumQuote
      summary: Pr√§mien-Angebote suchen
      description: Hauptendpoint f√ºr aktuelle Pr√§mienabfragen (2026).
      parameters:
        - name: canton
          in: query
          required: true
          description: Kanton (2-Buchstaben-Code, z.B. ZH, BE, GE)
          schema:
            type: string
            example: "ZH"
        - name: age_band
          in: query
          required: false
          description: Altersgruppe (child, young_adult, adult)
          schema:
            type: string
            enum: [child, young_adult, adult]
            default: adult
        - name: franchise_chf
          in: query
          required: false
          description: Franchise in CHF
          schema:
            type: string
            enum: ["0", "100", "200", "300", "400", "500", "600", "1000", "1500", "2000", "2500"]
            default: "2500"
        - name: accident_covered
          in: query
          required: false
          description: Mit Unfallversicherung
          schema:
            type: boolean
            default: true
        - name: model_type
          in: query
          required: false
          description: Versicherungsmodell (standard, hmo, telmed, family_doctor, diverse)
          schema:
            type: string
            enum: [standard, hmo, telmed, family_doctor, diverse]
            default: standard
        - name: limit
          in: query
          required: false
          description: Anzahl Resultate
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: Pr√§mien-Liste
          content:
            application/json:
              schema:
                type: object
                properties:
                  query:
                    type: object
                    description: Die verwendeten Suchparameter
                  results:
                    type: array
                    description: Liste der gefundenen Pr√§mien
                    items:
                      type: object
                      properties:
                        insurer_id:
                          type: string
                        insurer_name:
                          type: string
                        monthly_premium_chf:
                          type: number
                        annual_premium_chf:
                          type: number
                        model_type:
                          type: string
                        canton:
                          type: string
                        region:
                          type: string
                        tariff_name:
                          type: string
                  count:
                    type: integer
                    description: Anzahl gefundene Pr√§mien
                  statistics:
                    type: object
                    properties:
                      min:
                        type: number
                      max:
                        type: number
                      median:
                        type: number
                      average:
                        type: number
                  chart_url:
                    type: string
                    description: URL zu einem Balkendiagramm der Top 5 g√ºnstigsten Angebote

  /premiums/cheapest:
    get:
      operationId: getCheapestPremiums
      summary: G√ºnstigste Pr√§mien f√ºr Profile
      description: Top g√ºnstigste Versicherungen f√ºr vordefinierte Profile (2026).
      parameters:
        - name: canton
          in: query
          required: true
          description: Kanton (2-Buchstaben-Code)
          schema:
            type: string
            example: "ZH"
        - name: profile
          in: query
          required: true
          description: Profil (single_adult, couple, family_1kid, family_2kids, student, young_adult)
          schema:
            type: string
            enum: [single_adult, couple, family_1kid, family_2kids, student, young_adult]
            example: "single_adult"
        - name: limit
          in: query
          required: false
          description: Anzahl Resultate (Standard 5, Max 20)
          schema:
            type: integer
            default: 5
      responses:
        '200':
          description: Top Pr√§mien

  /leads/submit:
    post:
      operationId: submitLead
      summary: Offerte anfragen / Lead erfassen
      description: |
        Wenn der User ein Angebot buchen oder eine Offerte anfragen m√∂chte, 
        sammle die n√∂tigen Daten und rufe diesen Endpoint auf.
        Der User erh√§lt eine Best√§tigungs-E-Mail mit allen Details.
      security:
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - name
                - insurer_id
                - monthly_premium_chf
                - canton
                - age_band
                - franchise_chf
              properties:
                email:
                  type: string
                  format: email
                  description: E-Mail-Adresse des Kunden
                  example: "max.muster@example.ch"
                name:
                  type: string
                  description: Vor- und Nachname des Kunden
                  example: "Max Muster"
                phone:
                  type: string
                  description: Telefonnummer (optional)
                  example: "079 123 45 67"
                insurer_id:
                  type: string
                  description: ID des gew√§hlten Versicherers
                  example: "1318"
                insurer_name:
                  type: string
                  description: Name des Versicherers (optional, wird automatisch ermittelt)
                  example: "Assura"
                monthly_premium_chf:
                  type: number
                  description: Monatliche Pr√§mie in CHF
                  example: 305.10
                canton:
                  type: string
                  description: Kanton (2-Buchstaben-Code)
                  example: "ZH"
                age_band:
                  type: string
                  enum: [child, young_adult, adult]
                  description: Altersgruppe
                  example: "adult"
                franchise_chf:
                  type: integer
                  description: Gew√§hlte Franchise in CHF
                  example: 2500
                model_type:
                  type: string
                  enum: [standard, hmo, telmed, family_doctor, diverse]
                  description: Versicherungsmodell
                  default: "standard"
                accident_covered:
                  type: boolean
                  description: Mit Unfallversicherung
                  default: true
                message:
                  type: string
                  description: Zus√§tzliche Nachricht des Kunden (optional)
      responses:
        '200':
          description: Lead erfolgreich erfasst
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  lead_id:
                    type: string
                    description: Eindeutige ID des Leads
                  email_sent:
                    type: boolean
                    description: Ob die Best√§tigungs-E-Mail gesendet wurde
                  message:
                    type: string
                    description: Best√§tigungsnachricht
                  offer:
                    type: object
                    properties:
                      insurer:
                        type: string
                      monthly_premium_chf:
                        type: number
                      annual_premium_chf:
                        type: number
                      canton:
                        type: string
        '400':
          description: Ung√ºltige Eingabe
        '500':
          description: Serverfehler

components:
  schemas: {}
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API-Schl√ºssel f√ºr Zugriff
